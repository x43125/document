# 分库分表 & 主从

## 水平切分

> ShardingJdbc

当一个表的数据量过大的时候，可以将表中的数据拆分到多个结构相同的表中，分不到集群的不同节点上，缓解单个数据库的压力。

### 策略

- 哈希取模：hash(key)%NUM_DB
- 范围：ID范围或者时间范围
- 映射表：单独的一个数据库存储映射关系

### 问题及解决

- 事务问题：使用分布式事务来解决，比如XA接口
- JOIN：将原先的JOIN分解成多个单表查询，在程序中做JOIN
- ID唯一性：使用全局唯一ID：GUID；为每个分片制定一个ID范围；分布式ID生成器（twitter：**Snowflake算法**）

## 垂直切分

将一张表按列分成多个表，通常是按照列的关系密集程度切分，也可以将常使用的列和不常使用的列分到不同表中。

## 主从复制

- binlog线程：将**主服务器**的数据更改写入二进制日志中
- I/O线程：将**主服务器**的二进制日志，写入到**从服务器**的中继日志中
- SQL线程：读取**从服务器**的中继日志并重放其中的SQL

## 读写分离

主服务器处理写操作及实时性要求高的读操作

从服务器负责读操作



- 主从服务器负责各自的读/写，缓解了锁的争用
- 从服务器可以使用MyISAM，节约系统开销
- 增加冗余，提高可用性

