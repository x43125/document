# 优化

## 索引失效的场景

1. 使用否定查询：not in
2. 使用前导模糊搜索：like ‘%mysql’; like ‘%mysq%’

3. 在字段上进行计算：where id + 1 < 10

4. 最左前缀原则：使用联合索引的时候，要从左向后过滤（顺序无所谓）如：联合索引：`username, pwd` 

   那么在检索的时候：where username=‘asd’ and pwd=‘123’ 或 where pwd=‘123’ and username=‘asd’ 或 where username=‘asd’ **会**命中此联合索引

   where pwd=‘123’**不会**命中此联合索引

5. 不让数据库做类型转换：where name=1234 应该改为 where name=‘1234’

   如果做join操作，两表的join字段类型也要相同，否则不会走索引

## 建议

3. 如果一个字段没有明确区分，即可能大多数值都是一样的，那不建议创建索引，如：性别
4. 字段值的默认值不要设置成 null,这样可能搜索结果会和预期不同
5. 如果明确知道只会返回一条记录可以用limit来提前结束数据库的扫描：limit 1

## 宏观建议

1. 使用EXPLAIN分析
2. 使用慢查询日志分析
3. 减少请求的数据量
4. 减少服务器端扫描的行术
5. 切分大查询（分成多次功能相同的小查询）
6. 分解大连接查询（单表查询，在程序里关联）

