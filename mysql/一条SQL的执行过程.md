# 一条SQL的执行过程

1. 程序通过驱动与数据库服务器建立链接
2. 通过数据库连接池优化连接的创建和释放
3. 数据库服务端也有连接池来接受请求
4. 查询解析器：将SQL解析成mysql可以看懂的语言
5. 查询优化器：依据成本最小原则将你写的SQL优化成多个执行计划
6. 执行器：调用存储引擎API执行SQL
7. 先到buffer pool中找是否有符合要求的数据，有则返回，没有再去磁盘上读取。
   1. 在这一步，如果缓存中不存在数据，会将在磁盘上读取到的数据缓存在buffer pool中一份
   2. 这一步如果是更新操作，还会向**undo log**中插入一条记录，这条记录是修改前的数据，用于回滚或MVCC使用
   3. 在执行更新操作之后，会将修改后的数据记录到redo log buffer中，后续再写到**redo log** （InnoDB特有）中
   4. 提交之前，会将redo log buffer中的数据写到redo log中

## bin log

> 记录整个过程；MySQL级别；记录逻辑

如：对student表的id=1的记录做了更新操作

主要用于：主从复制，数据恢复

redo log主要用来崩溃恢复



## 总结：

从准备更新一条数据到事务的提交的流程描述

- 首先执行器根据 MySQL 的执行计划来查询数据，先是从缓存池中查询数据，如果没有就会去数据库中查询，如果查询到了就将其放到缓存池中
- 在数据被缓存到缓存池的同时，会写入 undo log 日志文件
- 更新的动作是在 BufferPool 中完成的，同时会将更新后的数据添加到 redo log buffer 中
- 完成以后就可以提交事务，在提交的同时会做以下三件事 
  - 将redo log buffer中的数据刷入到 redo log 文件中
  - 将本次操作记录写入到 bin log文件中
  - 将 bin log 文件名字和更新内容在 bin log 中的位置记录到redo log中，同时在 redo log 最后添加 commit 标记

<hr>
