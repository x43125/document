# Spring Cloud Overview

> 为了日益增长的分布式，微服务需求，Spring出了一套Spring Cloud的微服务架构，这一套架构旨在快速，方便的构建微服务开发框架。

在分布式系统中我们一般都会将服务拆分成多个微服务，然后对于一些比较重要的或是访问量比较大的服务，需要做冗余处理，也就是同时多起几个服务，以减轻系统压力或是备份防灾。

在这种情况下，首先我们会有多个不同模块的微服务，每个服务又有可能有多个服务。

针对这种比较混乱的情况：

**首先**，各服务之间会存在调用关系，需要知道有哪些服务可以调用；我们开发人员也需要知道都有哪些服务，方便观看服务状态。于是我们要有一个统一的注册中心，所有的微服务都注册到这个服务注册中心，当宕掉的时候在从注册中心剔除，以达到统一的中央管理目的。因此这个注册中心需要承担：服务发现，服务注册，服务监控的任务。

目前主流的注册中心有4个，分别是eureka, consul, zookeeper, nacos

**然后**，在服务拆分之前，我们的系统很多模块都是写在同一个进程内的，这种时候我们只需要去实例化对象，然后调用相应的方法即可实现我们的目的，但做了微服务拆分之后，我们的一些模块被拆分到了不同的服务里去，这样当我们涉及到不同服务之间的调用的时候，就无法再简单的使用方法调用了，此时就只能通过网络编程来实现了，常见的方法有：http方式和rpc方式。http方式的优点主要是通用，简单，http是应用层的网络模型，现在几乎所有的编程语言都支持，且是主流，更新迭代快。因此使用这种方式的时候，不同服务支持不同语言编写，非常的灵活。而他的缺点就是报文比较臃肿，传输速度相对慢一些。rpc的核心优势就是速度比较快，报文比较简单。而缺点也比较突出，他的使用上要复杂一些，并且他要求双方都适用同一种rpc框架，比如都使用dubbo。

因此主流的服务调用方式有：RestTemplate+ribbon 或 feign（底层包含RestTemplate+ribbon）        和 RPC（Dubbo）

**紧接着**，当服务之间在互相调用的时候，服务可能存在冗余服务，因此需要有负载均衡确定最终调用哪个服务。目前在微服务架构中常用Netflix的ribbon来实现负载均衡，它提供了诸多的负载均衡策略，主要有：轮询、随机、最少连接数、权重轮询及IP哈希。

**其次**，当服务被拆分成多个微服务，每个微服务又有冗余服务之后，我们在前台再调用的时候，就可能需要去频繁的更换IP来实现调用，因此需要一个网关来统一配置对外的接口信息。比如：user类有3个服务，分别在192.168.1.1，192.168.1.2，192.168.1.3服务器上，那么前台在调用某个user下的服务的时候，就需要针对性的自己去选择具体调用哪个服务器上的user服务，这显然太扯了。而配置了网关之后，即可以屏蔽具体的IP信息，直接通过比如`/user`来统一标识user下的服务，至于实际去到哪个服务器上由网关自己来决定。看上去他和ribbon有点像，实际上也是这样的，他的底层就依赖着ribbon，通过依赖ribbon来实现负载均衡。他们的主要区别是使用的场景不同。另一个比较常见的是nginx。

**最后**，服务在拆分成微服务之后，会有服务之间的调用，那不可避免的就会产生，长链路的调用。比如购物系统的下单过程包括：鉴权系统 -> 库存系统 -> 促销系统 -> 订单系统 -> 支付系统等，在这样的长链路中，如果某些下游服务的服务器扛不住压力导致大量请求无法及时返回，或是服务直接宕机了，都会导致上游的请求积压，久而久之会导致上游服务也宕机，从而导致整个链路甚至整个环境崩溃。这种时候一般有两种主要情况：服务熔断、服务降级

服务熔断：当链路中配置了服务熔断的服务发生故障或异常达到一定阈值的时候，会开启断路器，断路器会直接熔断该服务，而不是等待服务过时返回。说人话就是：某服务开启了断路器后，对该服务的所有请求将立刻以一个备用方案返回，而不会走之前的原有业务逻辑。

