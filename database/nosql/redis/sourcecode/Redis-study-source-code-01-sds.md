# Redis-Study-Source-code-01-SDS

> Redis自行设计的字符串结构：SDS (Simple Dynamic String)

## 特点

- 添加一个属性值 `len` 指示字符串长度

- 缓冲区溢出：字符串连接，如果字符串占用内存不够会自动扩充

- 惰性内存释放：通过将字符串尾的结束符置首，并修改 `free` 和 `len`属性，实际空间并未释放，再次扩展字符串时可以直接使用这部分的内存
- 二进制安全：通过使用`len`属性来判断而不是像c语言那样靠空字符来判断字符串是否结尾，所以可以存储任意二进制数据
- 像c语言一样也用空字符结尾：为了兼容`<string.h>`库定义的函数

## API

| 函数          | 作用                                                         | 时间复杂度                                                   |
| :------------ | :----------------------------------------------------------- | :----------------------------------------------------------- |
| `sdsnew`      | 创建一个包含给定 C 字符串的 SDS 。                           | O(N) ， `N` 为给定 C 字符串的长度。                          |
| `sdsempty`    | 创建一个不包含任何内容的空 SDS 。                            | O(1)                                                         |
| `sdsfree`     | 释放给定的 SDS 。                                            | O(1)                                                         |
| `sdslen`      | 返回 SDS 的已使用空间字节数。                                | 这个值可以通过读取 SDS 的 `len` 属性来直接获得， 复杂度为 O(1) 。 |
| `sdsavail`    | 返回 SDS 的未使用空间字节数。                                | 这个值可以通过读取 SDS 的 `free` 属性来直接获得， 复杂度为 O(1) 。 |
| `sdsdup`      | 创建一个给定 SDS 的副本（copy）。                            | O(N) ， `N` 为给定 SDS 的长度。                              |
| `sdsclear`    | 清空 SDS 保存的字符串内容。                                  | 因为惰性空间释放策略，复杂度为 O(1) 。                       |
| `sdscat`      | 将给定 C 字符串拼接到 SDS 字符串的末尾。                     | O(N) ， `N` 为被拼接 C 字符串的长度。                        |
| `sdscatsds`   | 将给定 SDS 字符串拼接到另一个 SDS 字符串的末尾。             | O(N) ， `N` 为被拼接 SDS 字符串的长度。                      |
| `sdscpy`      | 将给定的 C 字符串复制到 SDS 里面， 覆盖 SDS 原有的字符串。   | O(N) ， `N` 为被复制 C 字符串的长度。                        |
| `sdsgrowzero` | 用空字符将 SDS 扩展至给定长度。                              | O(N) ， `N` 为扩展新增的字节数。                             |
| `sdsrange`    | 保留 SDS 给定区间内的数据， 不在区间内的数据会被覆盖或清除。 | O(N) ， `N` 为被保留数据的字节数。                           |
| `sdstrim`     | 接受一个 SDS 和一个 C 字符串作为参数， 从 SDS 左右两端分别移除所有在 C 字符串中出现过的字符。 | O(M*N) ， `M` 为 SDS 的长度， `N` 为给定 C 字符串的长度。    |
| `sdscmp`      | 对比两个 SDS 字符串是否相同。                                | O(N) ， `N` 为两个 SDS 中较短的那个 SDS 的长度。             |
